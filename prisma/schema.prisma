// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Totals {
  id    Int    @id @default(autoincrement())
  day   Int
  month String
  year  Int
  valor Float  @default(0)

  @@map("totals")
}

model Costs {
  id         Int       @id @default(autoincrement())
  created_at DateTime? @default(now())
  vcost      Float

  @@map("costs")
}

model OrdersMaterialsInventories {
  id               Int      @id @default(autoincrement())
  description      String?
  fk_contractor_id Int?
  fk_id_client     Int?
  total            Float?
  totalSupplies    Float?
  totalInventories Float?
  created_at       DateTime @default(now())
  status           String?

  client                Clients?                @relation(fields: [fk_id_client], references: [id])
  contractor            Contractors?            @relation(fields: [fk_contractor_id], references: [id])
  // inventoriesTransactions inventoriesTransactions[]
  orderInventoriesItems OrderInventoriesItems[]
  orderMaterialsItems   OrderMaterialsItems[]
  // materialsTransactions   materialsTransactions[]

  @@map("ordersMaterialsInventories")
}

model OrderMaterialsItems {
  id                    Int     @id @default(autoincrement())
  fk_id_order_materials Int
  fk_id_material        Int
  qtd                   Int
  description           String?
  total                 Float?

  created_at DateTime?                  @default(now())
  material   Materials                  @relation(fields: [fk_id_material], references: [id])
  order      OrdersMaterialsInventories @relation(fields: [fk_id_order_materials], references: [id])

  @@map("ordersMaterialsItems")
}

model OrderInventoriesItems {
  id                              Int                        @id @default(autoincrement())
  fk_id_order_materials_inventory Int
  fk_id_inventory_sequence        Int
  qtd                             Int
  description                     String?
  total                           Float
  created_at                      DateTime?                  @default(now())
  inventoriesSequence             InventoriesSequence        @relation(fields: [fk_id_inventory_sequence], references: [id])
  orderInventories                OrdersMaterialsInventories @relation(fields: [fk_id_order_materials_inventory], references: [id])

  @@map("ordersInventoriesItems")
}

model Orders {
  id                 Int                @id @default(autoincrement())
  start              String
  end                String
  description        String
  notes              String?
  email              String?
  contact            String?
  contact_phone      String?
  address            String?
  support            String?
  fk_invoice_id      String?
  fk_support_id      Int?
  collaborators      String?
  fk_id_client       Int?
  total_hours        Float?
  created_at         DateTime           @default(now())
  status             Status             @default(PENDING)
  type               String?
  isInvoice          Boolean            @default(false)
  invoicesId         Int?
  ended_at           DateTime?          @default(now())
  client             Clients?           @relation(fields: [fk_id_client], references: [id])
  support_contractor Contractors?       @relation(fields: [fk_support_id], references: [id])
  ordersContractors  OrderContractors[]
  invoices           Invoices[]

  @@map("orders")
}

model OrderContractors {
  id               Int         @id @default(autoincrement())
  fk_id_order      Int
  fk_id_contractor Int
  end              String
  start            String
  total            Float
  created_at       DateTime?   @default(now())
  contractor       Contractors @relation(fields: [fk_id_contractor], references: [id])
  order            Orders      @relation(fields: [fk_id_order], references: [id])

  @@map("ordersContractors")
}

model Invoices {
  id               Int       @id @default(autoincrement())
  date_at          DateTime  @default(now())
  value            Float
  identification   String
  description      String?
  month            String
  year             Int
  taxa             Float?
  total            Float?
  total_pago       Float?
  date_payment     DateTime?
  method           String?
  ref              String?
  fk_id_order      Int?
  fk_id_client     Int?
  fk_id_contractor Int?
  quarter          Int?
  date_log         DateTime? @default(now())

  client     Clients?     @relation(fields: [fk_id_client], references: [id])
  order      Orders?      @relation(fields: [fk_id_order], references: [id])
  contractor Contractors? @relation(fields: [fk_id_contractor], references: [id])

  @@map("invoices")
}

model Payments {
  id          Int     @id @default(autoincrement())
  value       Float
  category    String
  description String?
  month       String
  year        Int

  @@map("payments")
}

model Balances {
  id    Int    @id @default(autoincrement())
  year  Int
  month String
  value Float

  @@map("balances")
}

model sales {
  id               Int       @id @default(autoincrement())
  name             String?
  contact          String?
  email            String?
  phone            String?
  region           String?
  status           String?
  bid              String?
  month            String?
  description      String?
  year             Int?
  created_at       DateTime? @default(now())
  fk_id_contractor Int?

  contractor Contractors? @relation(fields: [fk_id_contractor], references: [id])

  @@map("sales")
}

model Materials {
  id                         Int                          @id @default(autoincrement())
  name                       String?
  description                String?
  unit_cost                  Float?
  created_at                 DateTime?                    @default(now())
  url_image                  String?
  category                   String?
  fk_user                    Int?
  materialsTransactions      materialsTransactions[]
  user                       Contractors?                 @relation(fields: [fk_user], references: [id])
  materialsSalesTransactions materialsSalesTransactions[]
  // orderMaterialsItems        OrderMaterialsItems[]
  orderMaterialsItems        OrderMaterialsItems[]

  @@map("materials")
}

model Inventories {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  unit_cost   Float
  created_at  DateTime @default(now())
  url_image   String?
  status      String?  @default("ACTIVE")

  inventoriesSequences InventoriesSequence[]

  @@map("inventories")
}

model InventoriesSequence {
  id              Int      @id @default(autoincrement())
  seq             Int
  ref             String
  year            Int
  month           Int
  fk_id_inventory Int?
  created_at      DateTime @default(now())
  fk_user         Int?
  alter_at        DateTime @default(now())
  status          String   @default("unallocated")

  inventories             Inventories?              @relation(fields: [fk_id_inventory], references: [id])
  users                   Contractors?              @relation(fields: [fk_user], references: [id])
  inventoriesTransactions inventoriesTransactions[]
  logInventories          logInventories[]
  orderInventoriesItems   OrderInventoriesItems[]

  @@map("inventoriesSequence")
}

model logInventories {
  id                       Int                  @id @default(autoincrement())
  fk_id_inventory_sequence Int?
  fk_id_location           Int?
  previous_status          String
  new_status               String
  description              String?
  created_at               DateTime             @default(now())
  alter_at                 DateTime             @default(now())
  fk_id_user               Int?
  inventorySequence        InventoriesSequence? @relation(fields: [fk_id_inventory_sequence], references: [id])
  location                 Clients?             @relation(fields: [fk_id_location], references: [id])
  user                     Contractors?         @relation(fields: [fk_id_user], references: [id])

  @@map("logInventories")
}

model salesTransactions {
  id Int @id @default(autoincrement())

  description String?
  created_at  DateTime @default(now())
  update_at   DateTime @default(now())
  total       Float?

  materialsSalesTransactions materialsSalesTransactions[]

  @@map("salesTransactions")
}

model materialsSalesTransactions {
  id                    Int    @id @default(autoincrement())
  fk_id_material        Int?
  qtd                   Int?
  total                 Float?
  fk_id_materials_sales Int?

  transactionSales salesTransactions? @relation(fields: [fk_id_materials_sales], references: [id])
  material         Materials?         @relation(fields: [fk_id_material], references: [id])

  @@map("materialsSalesTransactions")
}

model materialsTransactions {
  id             Int      @id @default(autoincrement())
  created_at     DateTime @default(now())
  fk_id_material Int?
  quantity       Float
  total_cost     Float?
  fk_id_output   Int?
  fk_id_input    Int?
  description    String?
  month          String?
  year           Int?
  fk_user        Int?
  alter_at       DateTime @default(now())
  // fk_id_sales_transaction Int?
  // fk_id_order_materials   Int?

  // saleTransaction salesTransactions? @relation(fields: [fk_id_sales_transaction], references: [id])
  // orderMaterialInventories OrdersMaterialsInventories? @relation(fields: [fk_id_order_materials], references: [id])
  users    Contractors? @relation(fields: [fk_user], references: [id])
  material Materials?   @relation(fields: [fk_id_material], references: [id])
  output   Clients?     @relation(fields: [fk_id_output], references: [id], name: "materialsTransactionsOutput")
  input    Clients?     @relation(fields: [fk_id_input], references: [id], name: "materialsTransactionsInput")
  // salesTransactions   salesTransactions? @relation(fields: [salesTransactionsId], references: [id])
  // salesTransactionsId Int?

  @@map("materialsTransactions")
}

model inventoriesTransactions {
  id                       Int      @id @default(autoincrement())
  created_at               DateTime @default(now())
  fk_id_inventory_sequence Int?
  fk_id_client             Int?
  description              String?
  cost                     Float?
  fk_user                  Int?
  alter_at                 DateTime @default(now())
  status                   String   @default("active")

  users             Contractors?         @relation(fields: [fk_user], references: [id])
  inventorySequence InventoriesSequence? @relation(fields: [fk_id_inventory_sequence], references: [id])
  client            Clients?             @relation(fields: [fk_id_client], references: [id])

  @@map("inventoriesTransactions")
}

model Contractors {
  id                         Int          @id @default(autoincrement())
  email                      String       @unique
  first_name                 String
  middle_name                String?
  last_name                  String
  urlProfile                 String?
  urlDocumentProof           String?
  urlPrimaryResidencyProof   String?
  urlSecondaryResidencyProof String?
  status                     Status       @default(ACTIVE)
  acceptTerms                Boolean
  identification             String
  dob                        DateTime
  telephone                  String
  created_at                 DateTime     @default(now())
  fk_id_account              Int?         @unique
  fk_id_client_contractor    Int?
  ein                        String?
  type_pay                   String?
  address                    Adresseses[]
  account                    Accounts?    @relation(fields: [fk_id_account], references: [id])

  jobs              Jobs[]
  ordersSupport     Orders[]
  ordersContractors OrderContractors[]

  paymentsContractors        paymentsContractors[]
  Invoices                   Invoices[]
  sales                      sales[]
  inventoriesSequences       InventoriesSequence[]
  inventoriesTransactions    inventoriesTransactions[]
  materialsTransactions      materialsTransactions[]
  logInventories             logInventories[]
  materials                  Materials[]
  ordersMaterialsInventories OrdersMaterialsInventories[]

  @@map("contractors")
}

model Clients {
  id            Int        @id @default(autoincrement())
  name          String
  created_at    DateTime   @default(now())
  fk_id_account Int?       @unique
  start         String     @default("08:00")
  end           String     @default("18:00")
  monday        Boolean    @default(true)
  tuesday       Boolean    @default(true)
  wednesday     Boolean    @default(true)
  thursday      Boolean    @default(true)
  friday        Boolean    @default(true)
  saturday      Boolean    @default(true)
  sunday        Boolean    @default(false)
  contact       String?
  contact_phone String?
  address       String?
  email         String?
  status        Status     @default(ACTIVE)
  account       Accounts?  @relation(fields: [fk_id_account], references: [id])
  Invoices      Invoices[]
  Orders        Orders[]

  Jobs                        Jobs[]
  materialsTransactionsInput  materialsTransactions[]      @relation(name: "materialsTransactionsInput")
  materialsTransactionsOutput materialsTransactions[]      @relation(name: "materialsTransactionsOutput")
  inventoriesTransactions     inventoriesTransactions[]
  logInventories              logInventories[]
  ordersMaterialsInventories  OrdersMaterialsInventories[]

  @@map("clients")
}

model Adresseses {
  id               Int         @id @default(autoincrement())
  address          String
  city             String
  zipcode          String
  state            String
  fk_id_contractor Int
  created_at       DateTime    @default(now())
  contractor       Contractors @relation(fields: [fk_id_contractor], references: [id])

  @@map("addresses")
}

model Accounts {
  id            Int          @id @default(autoincrement())
  access        Access
  username      String
  password      String
  resetPassword Boolean      @default(false)
  status        Status       @default(ACTIVE)
  created_at    DateTime     @default(now())
  client        Clients?
  contractor    Contractors?

  @@map("accounts")
}

model Jobs {
  id               Int         @id @default(autoincrement())
  fk_id_contractor Int
  contractor       Contractors @relation(fields: [fk_id_contractor], references: [id])
  fk_id_client     Int
  client           Clients     @relation(fields: [fk_id_client], references: [id])
  created_at       DateTime    @default(now())
  start            String?     @default("08:00")
  end              String?     @default("18:00")
  monday           Boolean?    @default(true)
  tuesday          Boolean?    @default(true)
  wednesday        Boolean?    @default(true)
  thursday         Boolean?    @default(true)
  friday           Boolean?    @default(true)
  saturday         Boolean?    @default(true)
  sunday           Boolean?    @default(false)
  status           Status      @default(ACTIVE)
  Quarters         Quarters[]

  @@map("jobs")
}

model Quarters {
  id          Int            @id @default(autoincrement())
  fk_id_job   Int
  jobs        Jobs           @relation(fields: [fk_id_job], references: [id])
  value_hour  Float
  year        Int
  month       String
  order       Int
  status      Status         @default(PENDING)
  others      Float          @default(0)
  appointment Appointments[]

  @@map("quarters")
}

model Appointments {
  id            BigInt    @id @default(autoincrement())
  value         Float
  date          DateTime
  created_at    DateTime  @default(now())
  fk_id_quarter Int
  Quarters      Quarters? @relation(fields: [fk_id_quarter], references: [id])

  @@map("appointments")
}

model paymentsContractors {
  id               Int          @id @default(autoincrement())
  value            Float
  others           Float?
  method           Method?
  year             Int
  month            String
  date_at          DateTime     @default(now())
  type             Type
  description      String?
  quarter          Int?
  identification   String?      @default("")
  fk_id_contractor Int?
  status           Status?
  payed            Int?         @default(0)
  contractors      Contractors? @relation(fields: [fk_id_contractor], references: [id])
}

enum Access {
  CONTRACTOR
  CLIENT
  OFFICE
  ADMIN
  DEV
  MEDIUM
}

enum Role {
  CONTRACTOR
  CLIENT
  OFFICE
}

enum Status {
  REVISED
  ACTIVE
  RECEIPT
  NORECEIPT
  INACTIVE
  PENDING
}

enum Method {
  CHECK
  TRANSFER
  RECEIPT
  VENMO
  CARD
  CASH
}

enum Type {
  INPUT
  LABOUR_PAYROOL
  VAN_FUEL_OIL
  FUEL_OIL
  EQUIPMENT
  ADVERTISEMENT
  UNIFORM
  REPAIRS_MAINTENANCE
  OFFICE_EXPENSES
  MEALS
  CONTRACTOR
  CONTRACTOR_WORKERS
  CHEMICAL_CONSUMABLES
  INSURANCE_TAX
  EXTRAS
  GLOBAL
  MISC
  MONEYBACK
}
